#include <iostream>
#include <algorithm>
#include <cctype>  // for isalpha
using namespace std;

struct stack
{
    char data;
    stack *next;
} *top = NULL, *temp, *newnode;

int precedence(char op)
{
    if (op == '^')
        return 3;
    else if (op == '*' || op == '/')
        return 2;
    else if (op == '+' || op == '-')
        return 1;
    else
        return 0;
}

void push(char op)
{
    newnode = new stack;
    newnode->data = op;
    newnode->next = top;
    top = newnode;
}

char pop()
{
    char op;
    temp = top;
    top = top->next;
    op = temp->data;
    delete temp;
    return op;
}

void infixTopre(string infix)
{
    string p;
    int i;
    i = infix.length() - 1;

    push(')');
    infix = '(' + infix; // instead of infix[-1] = '('

    while (i >= 0)
    {
        if (isalpha(infix[i]))
        {
            p += infix[i];
        }
        else if (infix[i] == ')')
        {
            push(')');
        }
        else if (infix[i] == '*' || infix[i] == '/' || infix[i] == '-' || infix[i] == '+' || infix[i] == '^')
        {
            while (top != NULL && precedence(top->data) > precedence(infix[i]))
            {
                p += pop();
            }
            push(infix[i]);
        }
        else if (infix[i] == '(')
        {
            while (top != NULL && top->data != ')')
            {
                p += pop();
            }
            if (top != NULL)
                pop(); // pop ')'
        }
        i--;
    }

    // pop remaining operators
    while (top != NULL && top->data != ')')
    {
        p += pop();
    }

    cout << "\nPrefix Expression is: ";
    reverse(p.begin(), p.end());
    cout << p << endl;
}

int main()
{
    string infix;
    cout << "Enter the Infix Expression: ";
    cin >> infix;
    infixTopre(infix);
}
